machine:
  php:
    version: 5.5.11
  node:
    version: 0.10.38
dependencies:
  pre:
    - sed -i 's/^;//' ~/.phpenv/versions/$(phpenv global)/etc/conf.d/xdebug.ini
test:
  override:
    - vendor/bin/phpunit --debug --coverage-clover build/logs/clover.xml
  post:
    - vendor/bin/test-reporter
    - ./node_modules/.bin/bower install
    - ./node_modules/.bin/gulp
    - rm -rf node_modules/
    - rm -rf package.json
deployment:
  staging:
    branch: master
    commands:
      - heroku config:set BUILDPACK_URL=https://github.com/heroku/heroku-buildpack-php --app visa-status
      - heroku maintenance:on --app visa-status
      - heroku ps:scale web=0 --app visa-status
      - git push git@heroku.com:visa-status.git $CIRCLE_SHA1:master
      - heroku ps:scale web=1 --app visa-status
      - heroku maintenance:off --app visa-status